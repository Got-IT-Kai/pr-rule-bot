# v1.0 Release Plan

## Overview

This document outlines the release plan for pr-rule-bot v1.0, focusing on stabilizing the core AI-powered code review functionality before expanding to event-driven architecture and advanced features in v2.0.

## Release Goals

v1.0 aims to deliver a production-ready single AI processing system with essential features:

- Secure webhook handling with proper verification
- Robust token management with chunking support
- Request tracking and metadata management
- Clean dependency tree without unused components
- Comprehensive documentation and test coverage

## Scope

### Critical Security Fixes

**Webhook Signature Verification**
- Implement GitHub webhook signature validation using X-Hub-Signature-256 header
- Prevent unauthorized webhook requests
- Add signature verification utility and tests
- Reference: ADR-0003, Section 5.4 of comprehensive code review report

**Prevent Token Logging**
- Move GitHub token from default headers to ExchangeFilterFunction
- Configure WebClient logging to redact sensitive headers
- Add security audit for log outputs
- Reference: Section 3.5 and 5.1 of comprehensive code review report

**AI Prompt Injection Protection**
- Sanitize diff content before template processing
- Validate input for suspicious injection patterns
- Use unambiguous delimiters that cannot be forged
- Location: src/main/resources/prompts/code-review.st:24-27
- Reference: Code Review S-2

### High Priority Improvements

**Bot Identity Management Fix**
- Fix duplicate review detection to check bot identity, not all reviews
- Filter reviews by GitHub user type and login name
- Add fallback HTML comment marker for bot identification
- Location: src/main/java/com/code/agent/infra/github/service/GitHubReviewService.java:50-62
- Reference: ADR-0004, Code Review CI-3

**Rate Limiting Implementation** (Deferred to v2.0)
- ~~Implement distributed rate limiting using Bucket4j with Redis backend~~
- Decision: Not needed for v1.0 (personal project, single user)
- Rationale: Overengineering for single-user scenario, Kafka in v2.0 provides natural backpressure
- See ADR-0005 for details on deferral decision
- Will reconsider for v2.0 if opening to public/multi-user deployment

**Circuit Breaker Pattern** (Deferred to v2.0)
- ~~Add Resilience4j dependency for circuit breaker implementation~~
- Decision: Not needed for v1.0 (personal project, acceptable failure behavior)
- Rationale: Overengineering for single-user scenario, simple retry sufficient
- Alternative: Use WebClient retry or Spring Retry for transient failures
- See ADR-0007 for details on deferral decision
- Will reconsider for v2.0 if high-availability requirements emerge

**JavaDoc Documentation**
- Add class-level JavaDoc for all public classes
- Document port interfaces and their implementations
- Include usage examples for key components
- Reference: Section 1.1 of comprehensive code review report

**Event Listener Subscription Fix**
- Ensure proper subscription management for reactive event listeners
- Change return type from Mono<Void> to void with explicit subscribe()
- Add tests to verify event processing
- Reference: Section 2.4 of comprehensive code review report

**Test Coverage Improvements**
- AI adapters: Improve from 43% instruction coverage to 80%
- Webhook controller: Improve from 10% instruction coverage to 80%
- GitHub event models: Improve from 13% instruction coverage to 80%
- Add comprehensive integration tests for webhook flows
- Add security-focused tests for authentication and authorization
- Current overall coverage: 82% instruction, 60% branch
- Target overall coverage: 85% instruction, 70% branch

### Feature Enhancements

**Remove Unused Vector Database Dependencies**
- Identify and remove ChromaDB or other vector database dependencies
- Clean up related configuration and code
- Update documentation to reflect current architecture

**OTEL Configuration**
- Decision: Remove OTEL completely from v1.0
- Alternative: Implement minimal metrics/tracing if basic observability needed
- Remove OTEL dependencies from build.gradle
- Remove OTEL configurations from application.yml
- Document decision and rationale in ADR-0006
- Defer comprehensive observability to v2.0

**Token Chunking Enhancement**
- Replace token overlimit rejection with chunk-based processing
- Implement smart chunking that preserves code context
- Add chunking strategy configuration
- Enhance token counting accuracy
- Reference: Section 6.5 of comprehensive code review report

**Request Metadata Management**
- Design metadata schema for processed requests
- Implement storage mechanism for request/response history
- Add API endpoints to query processing history
- Support metadata-based duplicate detection

### Medium Priority Items

**Memory Leak Prevention**
- Replace collectList() with streaming or batching approach
- Add configurable maximum files per review limit
- Implement pagination for large diff processing
- Prevents OOM errors on PRs with many files
- Location: src/main/java/com/code/agent/application/service/CodeReviewService.java:46
- Reference: Code Review I-2

**Event Publisher Blocking Fix**
- Add subscribeOn(Schedulers.boundedElastic()) to event publisher
- Document synchronous nature of Spring's ApplicationEventPublisher
- Prevent blocking issues in reactive event handling
- Location: src/main/java/com/code/agent/infra/eventbus/adapter/SpringEventBusAdapter.java:17
- Reference: Section 2.2 of comprehensive code review report

**Configuration Improvements**
- Add @Validated annotation to AiClientProperties
- Extract hardcoded concurrency level to configuration
- Make retry strategies configurable
- Reference: Section 3.2 and 6.4 of comprehensive code review report

**Code Quality**
- Extract magic numbers to named constants
- Remove wildcard imports from test files
- Replace @Autowired(required=false) with Optional<T>
- Reference: Sections 1.2, 1.3, 1.4 of comprehensive code review report

**Webhook Event Sanitization**
- Sanitize webhook event logging to prevent sensitive data exposure
- Add structured logging for webhook events
- Reference: Section 5.4 of comprehensive code review report

## Implementation Order

1. Critical security fixes
   - Webhook signature verification (ADR-0003)
   - Prevent GitHub token logging
   - AI prompt injection protection
2. High priority bug fixes
   - Bot identity management fix
   - Event listener subscription management
3. Production reliability features
   - ~~Rate limiting implementation~~ (Deferred to v2.0 - ADR-0005)
   - ~~Circuit breaker pattern~~ (Deferred to v2.0 - ADR-0007)
4. Infrastructure cleanup
   - Remove OTEL configuration or implement minimal setup
   - Remove unused vector database dependencies
5. Test coverage improvements
   - AI adapter tests (43% → 80%)
   - Webhook controller tests (10% → 80%)
   - GitHub event model tests (13% → 80%)
6. Feature enhancements
   - Token chunking with smart context preservation
   - Request metadata management
7. Medium priority improvements
   - Memory leak prevention
   - Event publisher blocking fix
8. Documentation and code quality
   - Complete JavaDoc documentation
   - Extract magic numbers to constants
   - Configuration improvements

## Testing Strategy

- Unit tests for all new components
- Integration tests for webhook signature verification
- End-to-end tests for token chunking scenarios
- Security testing for sensitive data handling
- Token chunking edge cases (very large files, multiple languages, binary files)
- Webhook retry and failure scenarios
- Memory leak testing with large PR scenarios
- Prompt injection attack simulations

## Documentation Requirements

- JavaDoc for all public APIs
- Update README with v1.0 features
- Configuration guide for token chunking
- Metadata management API documentation
- Security best practices guide

## Post-v1.0 Roadmap (v2.0)

After v1.0 stabilization, the following features are planned:

- Event-driven architecture with Kafka integration (provides natural backpressure)
- Rate limiting (if opening to multi-user/public deployment)
- Circuit breaker pattern (if high-availability requirements emerge)
- RAG-based context enhancement using vector databases
- BM25 and advanced prompt engineering techniques
- Documentation review capabilities beyond pull requests
- Multi-repository support
- Enhanced observability and monitoring (OTEL full implementation)
- Service mesh integration for scalability

## Success Criteria

v1.0 will be considered ready for release when:

- All critical and high priority items are completed
- Test coverage exceeds 80% for new features
- Security audit passes without critical findings
- Documentation is complete and reviewed
- Performance benchmarks meet acceptance criteria
- Zero known security vulnerabilities
- All GitHub issues in v1.0 milestone are closed

## Timeline

Task-based implementation without strict deadlines.

## References

- Comprehensive Code Review Report: docs/code-review/comprehensive-code-review-report.md
- 2025-10-05 Comprehensive Review: docs/code-review/2025-10-05-comprehensive-review.md
- ADR-0003 Webhook Security: docs/adr/0003-webhook-security.md
- ADR-0004 Bot Identity Management: docs/adr/0004-bot-identity-management.md
- ADR-0005 Rate Limiting Strategy (Deferred): docs/adr/0005-rate-limiting.md
- ADR-0006 Observability Strategy: docs/adr/0006-observability-strategy.md
- ADR-0007 Circuit Breaker Pattern (Deferred): docs/adr/0007-circuit-breaker-pattern.md
- ADR-0008 Token Chunking Strategy: docs/adr/0008-token-chunking-strategy.md